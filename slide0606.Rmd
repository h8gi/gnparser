---
title: "\"gnparser\": a powerful parser for scientific names based on Parsing
Expression Grammar"
date: "`r lubridate::today()`"
author: "八木浩樹"
output: slidy_presentation
---

```{r setup, include = FALSE}
library(knitr)
library(tidyverse)
knitr::opts_chunk$set(cache = TRUE)
```

---

# "gnparser": a powerful parser for scientific names based on Parsing Expression Grammar

- 生物の学名表記には微妙なバリエーションがある
- それらをパースする既存のソフトウェアには速度、正確性などの点で問題がある
- プログラム言語などのパーサーに用いられている技術を使うことで、それらの問題を解決した

---

# 生物の学名表記
![**Carex scirpoidea convoluta**の様々な表記](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5446698/bin/12859_2017_1663_Fig1_HTML.jpg)

<!-- - var. が subsp. に変更された -->

---

# 生物の学名表記

**Carex scirpoidea var. convoluta Kükenthal** という文字列から

- genus: Carex
- species: scirpoidea
- variety: convoluta
- author: Kükenthal

の情報を手にいれるパーサーが必要

---

# パーサーってなに

- 文章をパースするプログラム
- ↓パース

```
> 今日は良い天気ですね
今日    名詞,副詞可能,*,*,*,*,今日,キョウ,キョー
は      助詞,係助詞,*,*,*,*,は,ハ,ワ
良い    形容詞,自立,*,*,形容詞・アウオ段,基本形,良い,ヨイ,ヨイ
天気    名詞,一般,*,*,*,*,天気,テンキ,テンキ
です    助動詞,*,*,*,特殊・デス,基本形,です,デス,デス
ね      助詞,終助詞,*,*,*,*,ね,ネ,ネ
```
- 自然言語はパースが難しい
- プログラミング言語はパースしやすい(そう作られているため)
```{r}
quote(3 * 5 + sqrt(3)) %>% as.list %>% str
```

---

## 既存のパーサー1 GBIF Name Parser

- Global Biodiversity Information Facilityが公開しているパーサー
  - `http://api.gbif.org/v1/parser/name?name=Carex scirpoidea var. convoluta Kükenthal`
	のように、URLのパラメーターに文字列を与えることでパースしてくれる
- 正規表現による実装

---

## 正規表現 (Regular expression)

- 文字列の集合を一つの文字列で表現する方法
- 携帯電話番号(= 文字列の集合)の正規表現(= 文字列) → `[0-9]{3}-[0-9]{4}-[0-9]{4}`
- 主に文字列のマッチングに使われる
- パースのために使おうと思えば使えないこともない

--- 

## パースのために使おうと思えば使えないこともない 
### 気象庁の天気概要を例に
- https://www.data.jma.go.jp/obd/stats/data/mdrr/man/gaikyo.html
- "晴れ時々曇り後雪、雷を伴う"
- 「基本天気用語」（必須）　＋　「天気変化用語」（0～3語）　＋　「伴う現象」（0～1語）

---

## パースのために使おうと思えば使えないこともない 
### 気象庁の天気概要を例に

> (快晴|晴|曇|薄曇|大風|霧|霧雨|雨|大雨|暴風雨|みぞれ|雪|大雪|暴風雪|地ふぶき|ふぶき|ひょう|あられ|雷|×)(?:((一時|時々|後|後一時|後時々)(快晴|晴|曇|薄曇|大風|霧|霧雨|雨|大雨|暴風雨|みぞれ|雪|大雪|暴風雪|地ふぶき|ふぶき|ひょう|あられ|雷|×)){0,3})(?:、(快晴|晴|曇|薄曇|大風|霧|霧雨|雨|大雨|暴風雨|みぞれ|雪|大雪|暴風雪|地ふぶき|ふぶき|ひょう|あられ|雷|×)を伴う)?

- 人間のやることではない
- 再帰構造を表現できないなど、根本的な限界がある
    - 雑種の学名は "学名 × 学名" という再帰構造をもつ

---

## 既存のパーサー2 biodiversity

- rubyによる生物学名のパーサーライブラリ
- https://github.com/GlobalNamesArchitecture/biodiversity
`gem install biodiversity`
- 正規表現ではなくPEGを利用している

---

## Parsing Expression Grammar (PEG)

- ある形式言語の文法を表現するための手法 
- ≒ プログラム言語のパーサーを書くための手法
- 正規表現では表現不可能だった再帰も扱える
- Yacc(Yet Another Compiler Compiler)と似たようなもの 

---

## Parsing Expression Grammar (PEG)
### 気象庁の天気概要を例に


> tenki <- 快晴|晴|曇|薄曇|大風|霧|霧雨|雨|大雨|暴風雨|みぞれ|雪|大雪|暴風雪|地ふぶき|ふぶき|ひょう|あられ|雷|×

> henka <- 一時|時々|後|後一時|後時々

> tenki (henka kihon)* (、kihon を伴う)?

- 上のPEG規則から、パーサーが生成される
- そのパーサーを使うことで、天気概要をパースできる

---

## gnparser

- Scala言語で実装(現在はGo言語)
- biodiversityの問題点

---

## 正確性の比較

---

## 速度の比較

---

# 八木の今後について

---

## サイエンスミュージアムネット

- 日本全国の博物館標本データ

---

## Use Go from R

